<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è‹±æ–‡é›²ç«¯å³æ™‚æ¸¬é©—ç³»çµ± - å­¸ç¿’å„€è¡¨æ¿ç‰ˆ</title>
    <script src="https://www.gstatic.com/firebasejs/9.16.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.16.0/firebase-database-compat.js"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Lexend:wght@400;700;900&family=Noto+Sans+TC:wght@400;700;900&display=swap');
        body { font-family: 'Lexend', 'Noto Sans TC', sans-serif; background-color: #F1F5F9; }
        .animate-fadeIn { animation: fadeIn 0.3s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        const firebaseConfig = {
            apiKey: "AIzaSyAUlvu46XOZe5tKULG17nJLHaTA9-Cbp1c",
            authDomain: "eng-practice-d3a17.firebaseapp.com",
            databaseURL: "https://eng-practice-d3a17-default-rtdb.firebaseio.com", 
            projectId: "eng-practice-d3a17",
            storageBucket: "eng-practice-d3a17.firebasestorage.app",
            messagingSenderId: "1015937569709",
            appId: "1:1015937569709:web:b82f057d2068e1be4a4724",
            measurementId: "G-WNCJQDVXYY"
        };

        if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        const quizData = [
            { id: 1, question: "The Great Wall is an _______ structure built thousands of years ago.", options: ["ancient", "antique", "previous", "precise"], correct: "ancient", explanation: "Ancient æŒ‡ã€Œå¤ä»£çš„ã€ã€‚" },
            { id: 2, question: "Scientists are working hard to develop an _______ to the new virus.", options: ["ancestor", "antibody", "antonym", "antidote"], correct: "antibody", explanation: "Antibody æ˜¯ã€ŒæŠ—é«”ã€ã€‚" },
            { id: 3, question: "We should take every _______ to ensure our safety during the trip.", options: ["precaution", "preference", "presence", "prediction"], correct: "precaution", explanation: "Precaution æŒ‡ã€Œé˜²ç¯„æªæ–½ã€ã€‚" },
            { id: 4, question: "It is difficult to _______ the weather accurately a month in advance.", options: ["prevent", "preserve", "predict", "prepare"], correct: "predict", explanation: "Predict æŒ‡ã€Œé æ¸¬ã€ã€‚" },
            { id: 5, question: "This shop sells _______ furniture from the 19th century.", options: ["antique", "ancient", "previous", "present"], correct: "antique", explanation: "Antique æŒ‡ã€Œå¤è‘£ã€ã€‚" },
            { id: 6, question: "Her _______ for classical music makes her different from her peers.", options: ["presence", "preference", "precaution", "precede"], correct: "preference", explanation: "Preference æŒ‡ã€Œåå¥½ã€ã€‚" },
            { id: 7, question: "The doctor prescribed a course of _______ to treat the infection.", options: ["antidote", "antonyms", "antibiotics", "ancestors"], correct: "antibiotics", explanation: "Antibiotic æ˜¯ã€ŒæŠ—ç”Ÿç´ ã€ã€‚" },
            { id: 8, question: "Please _______ for the meeting by reading the report beforehand.", options: ["prepare", "preserve", "prevent", "preview"], correct: "prepare", explanation: "Prepare æŒ‡ã€Œæº–å‚™ã€ã€‚" },
            { id: 9, question: "The guards try to _______ people from entering the building without a pass.", options: ["precede", "predict", "preserve", "prevent"], correct: "prevent", explanation: "Prevent æŒ‡ã€Œé˜²æ­¢ã€ã€‚" },
            { id: 10, question: "In the sentence 'Happy is the _______ of Sad', what word fits?", options: ["antibody", "antonym", "ancestor", "antidote"], correct: "antonym", explanation: "Antonym æŒ‡ã€Œåç¾©å­—ã€ã€‚" }
        ];

        function App() {
            const [view, setView] = useState('login'); 
            const [studentName, setStudentName] = useState('');
            const [currentIdx, setCurrentIdx] = useState(0);
            const [status, setStatus] = useState('idle');
            const [selectedOption, setSelectedOption] = useState(null);
            const [allLogs, setAllLogs] = useState([]);
            const [expandedId, setExpandedId] = useState(null);
            const [sessionAnswers, setSessionAnswers] = useState([]);
            const startTimeRef = useRef(null);

            useEffect(() => {
                const logsRef = db.ref('quiz_sessions');
                logsRef.on('value', (snapshot) => {
                    const data = snapshot.val();
                    if (data) {
                        setAllLogs(Object.entries(data).map(([id, val]) => ({ id, ...val })).reverse());
                    } else {
                        setAllLogs([]);
                    }
                });
                return () => logsRef.off();
            }, []);

            const handleAnswer = (choice) => {
                const endTime = Date.now();
                const timeTaken = ((endTime - startTimeRef.current) / 1000).toFixed(2);
                const isCorrect = choice === quizData[currentIdx].correct;
                setSessionAnswers([...sessionAnswers, { qText: quizData[currentIdx].question, choice, isCorrect, timeTaken }]);
                setSelectedOption(choice);
                setStatus('answered');
            };

            const finishQuiz = () => {
                const correctCount = sessionAnswers.filter(a => a.isCorrect).length;
                const score = correctCount * 10;
                const totalTime = sessionAnswers.reduce((sum, a) => sum + parseFloat(a.timeTaken), 0).toFixed(1);
                const finalData = { name: studentName, timestamp: new Date().toLocaleString(), correctRate: `${correctCount} / 10`, score, totalTime, details: sessionAnswers };
                db.ref('quiz_sessions').push(finalData);
                setSessionAnswers([]);
                setView('dashboard'); // å®Œæˆå¾Œè·³è½‰å„€è¡¨æ¿
                setCurrentIdx(0);
                setStatus('idle');
            };

            const getFeedback = (score) => {
                if (score >= 80) return { text: "å¾ˆå„ªç§€", icon: "ğŸ†", color: "text-yellow-500" };
                if (score >= 60) return { text: "å†æ¥å†å²", icon: "ğŸ‰", color: "text-blue-500" };
                return { text: "è¦ç”¨åŠŸäº†", icon: "ğŸ˜¢", color: "text-red-500" };
            };

            // --- å­¸ç”Ÿ/è€å¸«å…±é€šçš„ç´€éŒ„å¡ç‰‡çµ„ä»¶ ---
            const RecordCard = ({ session }) => {
                const isOpen = expandedId === session.id;
                const feedback = getFeedback(session.score);
                return (
                    <div className="bg-white rounded-[2rem] shadow-sm border border-slate-100 overflow-hidden mb-4">
                        <div className="p-6 cursor-pointer flex justify-between items-center" onClick={() => setExpandedId(isOpen ? null : session.id)}>
                            <div className="flex items-center space-x-4">
                                <div className="text-2xl">{feedback.icon}</div>
                                <div>
                                    <h3 className="font-black text-slate-700">{session.name}</h3>
                                    <p className="text-[10px] text-slate-300 font-bold uppercase">{session.timestamp}</p>
                                </div>
                            </div>
                            <div className="flex space-x-6 text-right">
                                <div><p className="text-[9px] text-slate-400 font-black">åˆ†æ•¸</p><p className={`font-black text-lg ${feedback.color}`}>{session.score}</p></div>
                                <div><p className="text-[9px] text-slate-400 font-black">ç‹€æ…‹</p><p className="font-bold text-slate-500 text-xs">{feedback.text}</p></div>
                                <div className={`transition-transform self-center ${isOpen ? 'rotate-180' : ''}`}>â–¼</div>
                            </div>
                        </div>
                        {isOpen && (
                            <div className="px-6 pb-6 bg-slate-50/50 animate-fadeIn">
                                <div className="space-y-2 mt-4">
                                    {session.details.map((item, idx) => (
                                        <div key={idx} className="flex justify-between items-center bg-white p-4 rounded-2xl border border-slate-100 text-[11px]">
                                            <span className="font-bold text-slate-500 flex-1 truncate mr-4">Q{idx+1}. {item.qText}</span>
                                            <span className={item.isCorrect ? "text-green-500 font-black" : "text-red-500 font-black"}>{item.isCorrect ? "âœ“" : `âœ— (${item.choice})`}</span>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        )}
                    </div>
                );
            };

            if (view === 'login') {
                return (
                    <div className="min-h-screen flex items-center justify-center bg-indigo-600 p-6">
                        <div className="bg-white p-10 rounded-[2.5rem] shadow-2xl w-full max-w-sm text-center">
                            <h1 className="text-3xl font-black text-indigo-900 mb-8 tracking-tighter italic">EngQuiz</h1>
                            <input type="text" placeholder="ä½ çš„å§“å" className="w-full p-4 bg-slate-50 rounded-2xl mb-4 text-center font-bold outline-none border-2 border-transparent focus:border-indigo-500"
                                value={studentName} onChange={e => setStudentName(e.target.value)} />
                            <button onClick={() => studentName && setView('quiz')} className="w-full bg-indigo-500 text-white py-4 rounded-2xl font-bold shadow-lg mb-3">é–‹å§‹æŒ‘æˆ°</button>
                            <button onClick={() => setView('dashboard')} className="w-full bg-slate-100 text-slate-600 py-4 rounded-2xl font-bold">å­¸ç¿’å„€è¡¨æ¿</button>
                            <button onClick={() => setView('admin_login')} className="mt-8 text-indigo-200 text-xs font-bold block mx-auto">ç®¡ç†å“¡ç™»å…¥</button>
                        </div>
                    </div>
                );
            }

            if (view === 'quiz') {
                if (status === 'idle') startTimeRef.current = Date.now();
                return (
                    <div className="max-w-md mx-auto mt-12 p-8 bg-white rounded-[2.5rem] shadow-xl border border-slate-100">
                        <div className="flex justify-between items-center mb-6 text-xs font-bold text-slate-300"><span>LEVEL 1</span><span>{currentIdx + 1} / 10</span></div>
                        <h2 className="text-xl font-bold text-slate-800 mb-8 leading-tight">{quizData[currentIdx].question}</h2>
                        <div className="space-y-3">
                            {quizData[currentIdx].options.map((opt, i) => (
                                <button key={i} onClick={() => status === 'idle' && handleAnswer(opt)}
                                    className={`w-full p-5 text-left border-2 rounded-2xl font-bold transition-all ${status === 'answered' ? (opt === quizData[currentIdx].correct ? 'border-green-500 bg-green-50 text-green-700' : (opt === selectedOption ? 'border-red-500 bg-red-50 text-red-700' : 'opacity-30')) : 'hover:border-indigo-500 hover:bg-indigo-50'}`}>
                                    {opt}
                                </button>
                            ))}
                        </div>
                        {status === 'answered' && (
                            <div className="mt-8 animate-fadeIn">
                                <p className="text-sm text-slate-500 mb-4 bg-slate-50 p-4 rounded-2xl italic border border-slate-100">è§£æï¼š{quizData[currentIdx].explanation}</p>
                                <button onClick={() => { if(currentIdx < 9) { setCurrentIdx(currentIdx+1); setStatus('idle'); setSelectedOption(null); } else { finishQuiz(); } }}
                                    className="w-full bg-slate-800 text-white py-4 rounded-2xl font-bold">
                                    {currentIdx < 9 ? "ä¸‹ä¸€é¡Œ" : "æŸ¥çœ‹å„€è¡¨æ¿çµæœ"}
                                </button>
                            </div>
                        )}
                    </div>
                );
            }

            if (view === 'dashboard' || view === 'admin') {
                const filteredLogs = view === 'dashboard' && studentName 
                    ? allLogs.filter(log => log.name === studentName) 
                    : allLogs;

                return (
                    <div className="max-w-4xl mx-auto p-6">
                        <div className="flex justify-between items-center mb-8">
                            <h1 className="text-3xl font-black text-slate-800 tracking-tighter">{view === 'dashboard' ? 'MY DASHBOARD' : 'ADMIN RECORDS'}</h1>
                            <div className="flex space-x-3">
                                {view === 'admin' && <button onClick={() => { if(window.confirm("ç¢ºå®šæ¸…ç©ºï¼Ÿ")) db.ref('quiz_sessions').remove(); }} className="bg-red-50 text-red-500 px-4 py-2 rounded-xl text-xs font-black">æ¸…ç©º</button>}
                                <button onClick={() => setView('login')} className="bg-slate-800 text-white px-6 py-2 rounded-xl font-bold text-xs shadow-lg">è¿”å›é¦–é </button>
                            </div>
                        </div>
                        {view === 'dashboard' && !studentName && <div className="bg-indigo-50 p-4 rounded-2xl text-indigo-600 font-bold text-center mb-6">è«‹åœ¨é¦–é è¼¸å…¥å§“åï¼Œå³å¯æŸ¥çœ‹å€‹äººå­¸ç¿’é€²åº¦</div>}
                        <div className="space-y-0">
                            {filteredLogs.length === 0 ? (
                                <div className="text-center py-20 text-slate-300 font-bold bg-white rounded-[2rem] border-2 border-dashed">å°šç„¡è³‡æ–™</div>
                            ) : filteredLogs.map(session => <RecordCard key={session.id} session={session} />)}
                        </div>
                    </div>
                );
            }

            if (view === 'admin_login') {
                return (
                    <div className="min-h-screen flex items-center justify-center p-6">
                        <div className="bg-white p-10 rounded-[2.5rem] shadow-xl w-full max-w-sm text-center">
                            <h2 className="font-black text-slate-800 text-xl mb-6 uppercase">Admin Access</h2>
                            <input type="password" placeholder="å¯†ç¢¼ 1208" className="w-full p-4 bg-slate-50 rounded-2xl mb-4 border-2 border-transparent focus:border-indigo-500 outline-none text-center font-bold"
                                onKeyDown={e => e.key === 'Enter' && e.target.value === '1208' && setView('admin')} autoFocus />
                            <button onClick={() => setView('login')} className="text-slate-400 font-bold text-xs">è¿”å›</button>
                        </div>
                    </div>
                );
            }
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
